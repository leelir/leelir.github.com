<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Introducing iOS Design Patterns in Swift Part 2ï¼ˆç¿»è¯‘ï¼Œæœªå®Œå¾…ç»­ã€‚ã€‚ã€‚ï¼‰</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="leelir">

    <!-- Le styles -->
    <link rel="stylesheet" href="https://leelir.github.io/theme/css/bootstrap.min.css" type="text/css" />
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      .tag-1 {
        font-size: 13pt;
      }
      .tag-2 {
        font-size: 10pt;
      }
      .tag-2 {
        font-size: 8pt;
      }
      .tag-4 {
        font-size: 6pt;
     }
    </style>
    <link href="https://leelir.github.io/theme/css/bootstrap-responsive.min.css" rel="stylesheet">
        <link href="https://leelir.github.io/theme/css/font-awesome.css" rel="stylesheet">

    <link href="https://leelir.github.io/theme/css/pygments.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="https://leelir.github.io/theme/images/favicon.ico">
    <link rel="apple-touch-icon" href="https://leelir.github.io/theme/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://leelir.github.io/theme/images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://leelir.github.io/theme/images/apple-touch-icon-114x114.png">

    <link href="https://leelir.github.io/" type="application/atom+xml" rel="alternate" title="H4C3R ATOM Feed" />

  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="https://leelir.github.io/index.html">H4C3R </a>
          <div class="nav-collapse">
            <ul class="nav">
                          <li class="divider-vertical"></li>
                  <li >
                    <a href="https://leelir.github.io/category/diary.html">
						<i class="icon-folder-open icon-large"></i>diary
					</a>
                  </li>
                  <li >
                    <a href="https://leelir.github.io/category/funny-things.html">
						<i class="icon-folder-open icon-large"></i>funny things
					</a>
                  </li>
                  <li class="active">
                    <a href="https://leelir.github.io/category/ios.html">
						<i class="icon-folder-open icon-large"></i>IOS
					</a>
                  </li>
                  <li >
                    <a href="https://leelir.github.io/category/svn.html">
						<i class="icon-folder-open icon-large"></i>svn
					</a>
                  </li>
                  <li >
                    <a href="https://leelir.github.io/category/work.html">
						<i class="icon-folder-open icon-large"></i>work
					</a>
                  </li>

                          <ul class="nav pull-right">
                                <li><a href="https://leelir.github.io/archives.html"><i class="icon-th-list"></i>Archives</a></li>
                          </ul>

            </ul>
            <!--<p class="navbar-text pull-right">Logged in as <a href="#">username</a></p>-->
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row">
        <div class="span9" id="content">
<section id="content">
        <article>
                <header>
                        <h1>
                                <a href=""
                                        rel="bookmark"
                                        title="Permalink to Introducing iOS Design Patterns in Swift Part 2ï¼ˆç¿»è¯‘ï¼Œæœªå®Œå¾…ç»­ã€‚ã€‚ã€‚ï¼‰">
                                        Introducing iOS Design Patterns in Swift Part 2ï¼ˆç¿»è¯‘ï¼Œæœªå®Œå¾…ç»­ã€‚ã€‚ã€‚ï¼‰
                                </a>
                        </h1>
                </header>
                <div class="entry-content">
                <div class="well">
<footer class="post-info">
<span class="label">Date</span>
<abbr class="published" title="2016-04-06T01:30:00+08:00">
        <i class="icon-calendar"></i>2016-04-06
</abbr>
<span class="label">By</span>
<a href="https://leelir.github.io/author/leelir.html"><i class="icon-user"></i>leelir</a>
<span class="label">Category</span>
<a href="https://leelir.github.io/category/ios.html"><i class="icon-folder-open"></i>IOS</a>.


<span class="label">Tags</span>
	<a href="https://leelir.github.io/tag/ios.html"><i class="icon-tag"></i>IOS</a>
</footer><!-- /.post-info -->                </div>
                <hr />
<p><strong>3æœˆ31æ—¥</strong> åˆšåˆšå¼€å§‹å†™ã€‚</p>
<p><strong>4æœˆ5æ—¥</strong>å†™ç€å†™ç€å°±å‡Œæ™¨ä¸€ç‚¹å¤šäº†ï¼Œåˆæ·»åŠ äº†ä¸€äº›å†…å®¹ã€‚æœ¬æ¥æƒ³ç€å†™åˆ°é¡¹ç›®ç›®å‰çš„çŠ¶æ€æ¥ï¼Œä¸è¿‡ä¹Ÿä¸æ—©äº†ï¼Œæ˜å¤©è¿˜è¦å¥½å¥½æƒ³ä¸€æƒ³è®ºæ–‡çš„å®éªŒçš„å‡ ä¸ªå…³é”®ç‚¹ã€‚ç¡äº†ï¼Œæ˜å¤©æ¥ç€å†™ã€‚ </p>
<p><strong>4æœˆ6æ—¥</strong>ç½‘ç»œä¸å¥½çœŸçš„å¾ˆè€½è¯¯äº‹ï¼Œè¿˜å½±å“å¿ƒæƒ…ï¼Œä»Šå¤©æ•´äº†ä¸€å¤©çš„ç½‘ï¼Œä¸å¼€å¿ƒã€‚æœ¬æ¥èƒ½å¤šåšå¥½å¤šäº‹çš„ï¼Œæ˜å¤©ç»§ç»­ã€‚</p>
<hr />
<p><strong>2015å¹´4æœˆ22æ—¥</strong>: Xcode6.3 å’ŒSwift1.2 æ›´æ–°<br />
<strong>æ›´æ–°æ—¥å¿—</strong>ï¼šè¿™æ¬¡IOS8å’ŒSwiftçš„æŒ‡å¯¼è¯¾æ˜¯æœ‰Vincent Ngoæ›´æ–°çš„ã€‚åŸç‰ˆæœ¬äº‹ç”±æŒ‡å¯¼è¯¾æˆå‘˜Eli Ganemæ¨å‡ºçš„ã€‚<br />
æ¬¢è¿å›åˆ°è®¾è®¡æ¨¡å¼ä»‹ç»æŒ‡å¯¼è¯¾çš„ç¬¬äºŒéƒ¨åˆ†ï¼åœ¨ç¬¬ä¸€éƒ¨åˆ†ï¼Œä½ å·²ç»å­¦ä¹ å…³äºCocoaçš„ä¸€äº›åŸºæœ¬çš„è®¾è®¡æ¨¡å¼ï¼Œä¾‹å¦‚MVCï¼Œå•ä¾‹æ¨¡å¼ï¼Œå’Œè£…é¥°æ¨¡å¼ç­‰ã€‚<br />
åœ¨æœ€åè¿™ä¸€éƒ¨åˆ†ï¼Œä½ å°†ä¼šå­¦ä¹ ä¸€äº›å…¶ä»–çš„ç”±å¤§é‡IOSå’ŒOS Xå¼€å‘è€…æå‡ºçš„ä¸€äº›åŸºæœ¬è®¾è®¡æ¨¡å¼ã€‚ä¾‹å¦‚ï¼šé€‚é…å™¨æ¨¡å¼ï¼Œè§‚å¯Ÿè€…æ¨¡å¼å’Œçºªå¿µå“æ¨¡å¼ã€‚è®©æˆ‘ä»¬é©¬ä¸Šå¼€å§‹å­¦ä¹ å§ï¼  </p>
<h1>Getting Started</h1>
<p>ä½ å¯ä»¥ä¸‹è½½<a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/BlueLibrarySwift-Part11.zip">ç¬¬ä¸€éƒ¨åˆ†çš„å®ä¾‹ä»£ç </a>å¼€å§‹è¿™ä¸€éƒ¨åˆ†ã€‚<br />
è¿™æ˜¯æˆ‘ä»¬åœ¨ç¬¬ä¸€éƒ¨åˆ†ç»“æŸçš„æ—¶å€™å®Œæˆçš„éŸ³ä¹åº“APPï¼š
<div align=center>
<img src="http://www.raywenderlich.com/wp-content/uploads/2014/11/Screen-Shot-2014-11-11-at-12.38.53-AM.png" width="240" height="430" alt="ç¬¬ä¸€éƒ¨åˆ†æ•ˆæœå›¾"/>
</div><br />
è¿™ä¸ªAPPåŸæ¥çš„è®¾è®¡æ˜¯åœ¨å±å¹•çš„é¡¶éƒ¨è®¾è®¡ä¸€ä¸ªæ°´å¹³æ»šåŠ¨çª—å£æ¥é€‰æ‹©ç›¸å†Œã€‚æ—¢ç„¶ä¸æ˜¯ä¸ºäº†å•ä¸€çš„ç›®çš„è€Œè®¾è®¡ä½¿ç”¨çš„ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ä½¿ä»–ä¸ºæ¯ä¸€ä¸ªè§†å›¾é‡å¤ä½¿ç”¨å‘¢ï¼Ÿ<br />
ä¸ºäº†ä½¿è¿™ä¸ªè§†å›¾é‡å¤ä½¿ç”¨ï¼Œå› æ­¤æ‰€æœ‰å…³äºå®ƒå†…å®¹çš„å†³å®šéƒ½è¦äº¤ç»™å¦ä¸€ä¸ªå¯¹è±¡ï¼šä¸€ä¸ªå§”æ‰˜ã€‚è¿™ä¸ªæ°´å¹³æ»‘åŠ¨è§†å›¾è¦å£°æ˜å§”æ‰˜å·¥å…·ï¼ˆdelegate implementsï¼‰çš„æ–¹æ³•æ¥ä½¿ä»–ä¸ºæ»šåŠ¨çª—å£å·¥ä½œã€‚è¿™ç§æ–¹æ³•ä¸€UITableViewå§”æ‰˜æ–¹æ³•ç›¸ä¼¼ã€‚æˆ‘ä»¬å°†åœ¨æ¥ä¸‹æ¥çš„è¦è®¨è®ºçš„è®¾è®¡æ¨¡å¼ä¸­ç”¨åˆ°è¿™ç§æ–¹æ³•ã€‚  </p>
<h1>The Adapter Pattern</h1>
<p>é€‚é…å™¨å¯ä»¥ä½¿æ¥å£ä¸åŒ¹é…çš„ç±»ä¸€èµ·å·¥ä½œã€‚ä»–ç”¨ä¸€ä¸ªç±»å°†è‡ªå·±åŒ…è£¹èµ·æ¥ï¼Œå¹¶ä¸”æš´éœ²å‡ºæ ‡å‡†æ¥å£ç»™è¦äº¤æµçš„ç±»ã€‚<br />
å¦‚æœä½ ç†Ÿæ‚‰é€‚é…å™¨æ¨¡å¼ï¼Œä½ ä¼šå‘ç°ï¼Œè‹¹æœçš„ç”¨ä¸€ç§å®Œå…¨ä¸åŒçš„æ–¹æ³•ä½¿ç”¨å®ƒï¼è‹¹æœç”¨åè®®æ¥å®Œæˆè¿™ä»½å·¥ä½œã€‚ä½ å¯èƒ½å·²ç»äº†è§£äº†UITableViewDelegateï¼ŒUIScrollViewDelegateï¼ŒNSCodingå’ŒNSCopying. ä¾‹å¦‚ï¼šåœ¨NSCopyingåè®®é‡Œé¢ï¼Œæ¯ä¸€ç§åè®®å¯ä»¥æä¾›ä¸€ç§æ ‡å‡†çš„å¤åˆ¶æ–¹æ³•ã€‚</p>
<h1>How to Use the Adapter Pattern</h1>
<p>æ°´å¹³æ»‘åŠ¨çš„æ–¹æ³•çœ‹èµ·æ¥ä¼šæ˜¯è¿™æ ·çš„ï¼š
<div align=center>
<img src="http://www.raywenderlich.com/wp-content/uploads/2014/11/swiftDesignPattern7.png" width="450" height="140" alt="ç›¸å†Œæ•ˆæœå›¾"/>
</div>
åœ¨å¼€å§‹ä¹‹å‰ï¼Œåœ¨å·¥ç¨‹è§†å›¾é‡Œé¢é€‰æ‹©æ–°å»ºæ–‡ä»¶é€‰æ‹©IOSã€‹cocola touch class å¹¶ä¸”ç‚¹å‡»ä¸‹ä¸€æ­¥ã€‚è®¾ç½®ç±»åä¸ºHorizontalSCrollerï¼Œä½¿ä»–ç»§æ‰¿è‡ªUIViewã€‚<br />
æ‰“å¼€HorizontalSCroller.swift ç„¶åæ’å…¥å¦‚ä¸‹ä»£ç ï¼š  </p>
<div class="highlight"><pre><span class="kr">@objc</span> <span class="kd">protocol</span> <span class="nc">HorizontalScrollerDelegate</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>


<p>å®šä¹‰ä¸€ä¸ªåä¸ºHorizontalScrollerDelegateçš„åè®®ã€‚ä½ éœ€è¦åœ¨åè®®å£°æ˜å‰æ·»åŠ ä¸€ä¸ª@objcã€‚ç„¶åä½ å°±å¯ä»¥åƒåœ¨Objectï¼Cé‡Œé¢ä¸€æ ·å¥½å¥½ä½¿ç”¨@optionalä»£ç†çš„æ–¹æ³•äº†ã€‚<br />
ä½ å®šä¹‰äº†éœ€è¦çš„å’Œå¯é€‰çš„æ–¹æ³•ï¼Œç„¶åä»£ç†å°±ä¼šä½¿ç”¨åè®®ä¸­çš„æ–¹æ³•ã€‚å› æ­¤åœ¨åè®®ä¸­åŠ å…¥å¦‚ä¸‹æ–¹æ³•ï¼š</p>
<div class="highlight"><pre><span class="c1">// ask the delegate how many views he wants to present inside the horizontal scroller</span>
<span class="kd">func</span> <span class="nf">numberOfViewsForHorizontalScroller</span><span class="p">(</span><span class="n">scroller</span><span class="p">:</span> <span class="n">HorizontalScroller</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Int</span>
<span class="c1">// ask the delegate to return the view that should appear at &lt;index&gt;</span>
<span class="kd">func</span> <span class="nf">horizontalScrollerViewAtIndex</span><span class="p">(</span><span class="n">scroller</span><span class="p">:</span> <span class="n">HorizontalScroller</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span><span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="bp">UIView</span>
<span class="c1">// inform the delegate what the view at &lt;index&gt; has been clicked</span>
<span class="kd">func</span> <span class="nf">horizontalScrollerClickedViewAtIndex</span><span class="p">(</span><span class="n">scroller</span><span class="p">:</span> <span class="n">HorizontalScroller</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span><span class="nb">Int</span><span class="p">)</span>
<span class="c1">// ask the delegate for the index of the initial view to display. this method is optional</span>
<span class="c1">// and defaults to 0 if it&#39;s not implemented by the delegate</span>
<span class="kr">optional</span> <span class="kd">func</span> <span class="nf">initialViewIndex</span><span class="p">(</span><span class="n">scroller</span><span class="p">:</span> <span class="n">HorizontalScroller</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Int</span>
</pre></div>


<p>ç°åœ¨å·²ç»æœ‰äº†å¿…éœ€çš„æ–¹æ³•å’Œå¯é€‰çš„æ–¹æ³•ã€‚å¿…éœ€çš„æ–¹æ³•æ˜¯ä»£ç†å¿…éœ€ä½¿ç”¨çš„ï¼Œå¹¶ä¸”é€šå¸¸åŒ…å«è€…ä¸€äº›ç±»å¿…éœ€ç”¨åˆ€çš„æ•°æ®ã€‚åœ¨è¿™ä¸ªä¾‹å­é‡Œé¢ï¼Œè¿™äº›å¿…éœ€çš„ç»†èŠ‚æ˜¯viewçš„æ•°é‡ï¼Œviewçš„å…·ä½“ç¼–å·å’Œå½“viewè¢«è§¦æ‘¸æ—¶çš„è¡Œä¸ºã€‚å¯é€‰æ–¹æ³•æ˜¯viewçš„åˆå§‹åŒ–ï¼›å¦‚æœå®ƒæ²¡æœ‰è¢«ä½¿ç”¨HorizontalScrollerå°†ä¼šé»˜è®¤è®¾ç½®ä¸ºç¬¬ä¸€ä¸ªã€‚<br />
åœ¨HorizontalScroller.swifté‡ŒåŠ ä¸Šå¦‚ä¸‹ä»£ç å®šä¹‰HorizontalScrollerç±»ï¼š</p>
<div class="highlight"><pre><span class="kr">weak</span> <span class="kd">var</span> <span class="nv">delegate</span><span class="p">:</span> <span class="n">HorizontalScrollerDelegate</span><span class="p">?</span>
</pre></div>


<p>å°†ä½ å®šä¹‰çš„å˜é‡å±æ€§è®¾ç½®ä¸ºweakï¼Œè¿™æ˜¯é¿å…æ­»å¾ªç¯è€Œå¿…éœ€åšçš„ã€‚å¦‚æœç±»ä¸å®ƒçš„ä»£ç†æœ‰ç€å¼ºå¼•ç”¨å…³ç³»ï¼Œå¹¶ä¸”ä»£ç†å¯¹å®ƒéµä»çš„ç±»ä¹Ÿä¿æŒç€å¼ºå¼•ç”¨ï¼Œä½ çš„APPå°†ä¼šå†…å­˜ä¸è¶³ï¼Œå› ä¸ºæ‰€æœ‰çš„ç±»éƒ½ä¸ä¼šé‡Šæ”¾å†…å­˜å†åˆ†é…ç»™å…¶ä»–ç±»ã€‚swifté‡Œé¢æ‰€æœ‰çš„å˜é‡éƒ½é»˜è®¤æ˜¯strongã€‚<br />
ä»£ç†æ˜¯å¯é€‰çš„ï¼Œå› æ­¤ï¼Œæ— è®ºæ˜¯è°éƒ½å¯èƒ½ä¸æ¯”æä¾›ä»£ç†è€Œä½¿ç”¨è¿™ä¸ªç±»ã€‚ä½†æ˜¯ï¼Œå¦‚æœå®ƒä»¬è¿™ä¹ˆåšäº†ï¼Œå®ƒå°±ä¼šéµä»HorizontalScrollerDelegate å¹¶ä¸”å¯ä»¥ä¿è¯åè®®é‡Œçš„æ–¹æ³•æ˜¯å¯ä»¥åœ¨è¿™é‡Œè¢«ä½¿ç”¨çš„ã€‚<br />
ä¸ºç±»æ·»åŠ å‡ ä¸ªçš„å˜é‡ï¼š  </p>
<div class="highlight"><pre><span class="c1">// 1</span>
<span class="kd">private</span> <span class="kd">let</span> <span class="nv">VIEW_PADDING</span> <span class="p">=</span> <span class="mi">10</span>
<span class="kd">private</span> <span class="kd">let</span> <span class="nv">VIEW_DIMENSIONS</span> <span class="p">=</span> <span class="mi">100</span>
<span class="kd">private</span> <span class="kd">let</span> <span class="nv">VIEWS_OFFSET</span> <span class="p">=</span> <span class="mi">100</span>
<span class="c1">// 2</span>
<span class="kd">private</span> <span class="kd">var</span> <span class="nv">scroller</span> <span class="p">:</span> <span class="bp">UIScrollView</span><span class="p">!</span>
<span class="c1">// 3</span>
<span class="kd">var</span> <span class="nv">viewArray</span> <span class="p">=</span> <span class="p">[</span><span class="bp">UIView</span><span class="p">]()</span>
</pre></div>


<p>ä¸‹é¢ç»™å‡ºæ¯ä¸€å—ä»£ç çš„æ³¨é‡Šï¼š<br />
1.å®šä¹‰å¸¸é‡ä½¿ä»–åœ¨è®¾è®¡æ—¶æ›´å®¹æ˜“æ¨¡å—åŒ–ã€‚scrolleré‡Œé¢viewçš„å¤§å°æ˜¯100ï¼Š100ï¼Œåˆ°é—­åˆé•¿æ–¹å½¢è¾¹ç•Œæœ‰10åƒç´ ç‚¹ã€‚<br />
2.åˆ›å»ºä¸€ä¸ªscrolleråŒ…å«è¿™ä¸ªviewã€‚<br />
3.åˆ›å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰ç›¸å†Œå°é¢çš„æ•°ç»„ã€‚
æ¥ä¸‹æ¥å°±è¦æ‰§è¡Œåˆå§‹åŒ–ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š  </p>
<div class="highlight"><pre><span class="c1">// 1</span>
<span class="kd">private</span> <span class="kd">let</span> <span class="nv">VIEW_PADDING</span> <span class="p">=</span> <span class="mi">10</span>
<span class="kd">private</span> <span class="kd">let</span> <span class="nv">VIEW_DIMENSIONS</span> <span class="p">=</span> <span class="mi">100</span>
<span class="kd">private</span> <span class="kd">let</span> <span class="nv">VIEWS_OFFSET</span> <span class="p">=</span> <span class="mi">100</span>
<span class="c1">// 2</span>
<span class="kd">private</span> <span class="kd">var</span> <span class="nv">scroller</span> <span class="p">:</span> <span class="bp">UIScrollView</span><span class="p">!</span>
<span class="c1">// 3</span>
<span class="kd">var</span> <span class="nv">viewArray</span> <span class="p">=</span> <span class="p">[</span><span class="bp">UIView</span><span class="p">]()</span>
</pre></div>


<div class="highlight"><pre> <span class="kr">override</span> <span class="kd">init</span><span class="p">(</span><span class="n">frame</span><span class="p">:</span> <span class="bp">CGRect</span><span class="p">)</span> <span class="p">{</span>
  <span class="kc">super</span><span class="p">.</span><span class="kd">init</span><span class="p">(</span><span class="n">frame</span><span class="p">:</span> <span class="n">frame</span><span class="p">)</span>
  <span class="n">initializeScrollView</span><span class="p">()</span>
<span class="p">}</span>
<span class="kr">required</span> <span class="kd">init</span><span class="p">(</span><span class="n">coder</span> <span class="n">aDecoder</span><span class="p">:</span> <span class="bp">NSCoder</span><span class="p">)</span> <span class="p">{</span>
  <span class="kc">super</span><span class="p">.</span><span class="kd">init</span><span class="p">(</span><span class="n">coder</span><span class="p">:</span> <span class="n">aDecoder</span><span class="p">)</span>
  <span class="n">initializeScrollView</span><span class="p">()</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">initializeScrollView</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">//1</span>
  <span class="n">scroller</span> <span class="p">=</span> <span class="bp">UIScrollView</span><span class="p">()</span>
  <span class="n">addSubview</span><span class="p">(</span><span class="n">scroller</span><span class="p">)</span>
  <span class="c1">//2</span>
  <span class="n">scroller</span><span class="p">.</span><span class="n">setTranslatesAutoresizingMaskIntoConstraints</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
  <span class="c1">//3</span>
  <span class="kc">self</span><span class="p">.</span><span class="n">addConstraint</span><span class="p">(</span><span class="bp">NSLayoutConstraint</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="n">scroller</span><span class="p">,</span> <span class="n">attribute</span><span class="p">:</span> <span class="p">.</span><span class="n">Leading</span><span class="p">,</span> <span class="n">relatedBy</span><span class="p">:</span> <span class="p">.</span><span class="n">Equal</span><span class="p">,</span> <span class="n">toItem</span><span class="p">:</span> <span class="kc">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">:</span> <span class="p">.</span><span class="n">Leading</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">constant</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">))</span>
  <span class="kc">self</span><span class="p">.</span><span class="n">addConstraint</span><span class="p">(</span><span class="bp">NSLayoutConstraint</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="n">scroller</span><span class="p">,</span> <span class="n">attribute</span><span class="p">:</span> <span class="p">.</span><span class="n">Trailing</span><span class="p">,</span> <span class="n">relatedBy</span><span class="p">:</span> <span class="p">.</span><span class="n">Equal</span><span class="p">,</span> <span class="n">toItem</span><span class="p">:</span> <span class="kc">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">:</span> <span class="p">.</span><span class="n">Trailing</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">constant</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">))</span>
  <span class="kc">self</span><span class="p">.</span><span class="n">addConstraint</span><span class="p">(</span><span class="bp">NSLayoutConstraint</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="n">scroller</span><span class="p">,</span> <span class="n">attribute</span><span class="p">:</span> <span class="p">.</span><span class="n">Top</span><span class="p">,</span> <span class="n">relatedBy</span><span class="p">:</span> <span class="p">.</span><span class="n">Equal</span><span class="p">,</span> <span class="n">toItem</span><span class="p">:</span> <span class="kc">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">:</span> <span class="p">.</span><span class="n">Top</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">constant</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">))</span>
  <span class="kc">self</span><span class="p">.</span><span class="n">addConstraint</span><span class="p">(</span><span class="bp">NSLayoutConstraint</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="n">scroller</span><span class="p">,</span> <span class="n">attribute</span><span class="p">:</span> <span class="p">.</span><span class="n">Bottom</span><span class="p">,</span> <span class="n">relatedBy</span><span class="p">:</span> <span class="p">.</span><span class="n">Equal</span><span class="p">,</span> <span class="n">toItem</span><span class="p">:</span> <span class="kc">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">:</span> <span class="p">.</span><span class="n">Bottom</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">constant</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">))</span>
  <span class="c1">//4</span>
  <span class="kd">let</span> <span class="nv">tapRecognizer</span> <span class="p">=</span> <span class="bp">UITapGestureRecognizer</span><span class="p">(</span><span class="n">target</span><span class="p">:</span> <span class="kc">self</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span><span class="nb">Selector</span><span class="p">(</span><span class="s">&quot;scrollerTapped:&quot;</span><span class="p">))</span>
  <span class="n">scroller</span><span class="p">.</span><span class="n">addGestureRecognizer</span><span class="p">(</span><span class="n">tapRecognizer</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>é‡è£…çš„æ–¹æ³•æ˜¯åœ¨é‡æ–°åŠ è½½UITableViewæ•°æ®æ•°æ®ä¹‹åå»ºæ¨¡çš„ï¼›å®ƒé‡æ–°åŠ è½½æ‰€æœ‰çš„æ•°æ®ç”¨äºæ„å»ºhorizontal scrollerã€‚<br />
ä¸‹é¢æ˜¯æ¯ä¸€æ­¥çš„æ­¥éª¤ï¼š<br />
1.åˆ›å»ºä¸€ä¸ªæ–°çš„UIScrollerViewå®ä¾‹å¹¶ä¸”æŠŠå®ƒæ·»åŠ åˆ°çˆ¶è§†å›¾ã€‚<br />
2.å…³é—­è‡ªåŠ¨æ’ç‰ˆã€‚è¿™æ ·ä½ å°±å¯ä»¥ä½¿ç”¨ä½ è‡ªå·±çš„å¸ƒå±€çº¦æŸæ¡ä»¶ã€‚<br />
3.å¯¹scrollviewä½¿ç”¨çº¦æŸæ¡ä»¶ï¼Œä½¿scroller viewå®Œå…¨å¡«å……æ»¡horizontalscroller<br />
4.åˆ›å»ºä¸€ä¸ªtapæ‰‹åŠ¿è¯†åˆ«ã€‚tapæ”¶æ‹¾è¯†åˆ«æ¢æµ‹åœ¨scrollerviewä¸Šçš„è§¦æ‘¸å¹¶ä¸”æ£€æŸ¥æ˜¯å¦æœ‰ç›¸å†Œå°é¢è¢«é€‰ä¸­ã€‚å¦‚æœè¢«é€‰ä¸­å°†ä¼šé€šçŸ¥horizontalscroller delegateã€‚<br />
ç°åœ¨å†æ·»åŠ ä¸Šè¿™ä¸ªæ–¹æ³•ï¼š  </p>
<div class="highlight"><pre><span class="kd">func</span> <span class="nf">scrollerTapped</span><span class="p">(</span><span class="n">gesture</span><span class="p">:</span> <span class="bp">UITapGestureRecognizer</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">location</span> <span class="p">=</span> <span class="n">gesture</span><span class="p">.</span><span class="n">locationInView</span><span class="p">(</span><span class="n">gesture</span><span class="p">.</span><span class="n">view</span><span class="p">)</span>
    <span class="k">if</span> <span class="kd">let</span> <span class="nv">delegate</span> <span class="p">=</span> <span class="n">delegate</span> <span class="p">{</span>
      <span class="k">for</span> <span class="n">index</span> <span class="k">in</span> <span class="mf">0.</span><span class="p">.&lt;</span><span class="n">delegate</span><span class="p">.</span><span class="n">numberOfViewsForHorizontalScroller</span><span class="p">(</span><span class="kc">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">view</span> <span class="p">=</span> <span class="n">scroller</span><span class="p">.</span><span class="n">subviews</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="kc">as</span><span class="p">!</span> <span class="bp">UIView</span>
        <span class="k">if</span> <span class="n">CGRectContainsPoint</span><span class="p">(</span><span class="n">view</span><span class="p">.</span><span class="n">frame</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">delegate</span><span class="p">.</span><span class="n">horizontalScrollerClickedViewAtIndex</span><span class="p">(</span><span class="kc">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">index</span><span class="p">)</span>
          <span class="n">scroller</span><span class="p">.</span><span class="n">setContentOffset</span><span class="p">(</span><span class="bp">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">view</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="kc">self</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">view</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">),</span> <span class="n">animated</span><span class="p">:</span><span class="kc">true</span><span class="p">)</span>
          <span class="k">break</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
</pre></div>


<p>è¿™ä¸ªæ‰‹åŠ¿ä»¥ä¸€ä¸ªå…ƒç´ ä¼ å…¥ï¼Œä½¿ä½ ç”¨locationInViewï¼ˆï¼‰æ¥æå–ä½ç½®ä¿¡æ¯ã€‚<br />
æ¥ä¸‹æ¥ï¼Œè°ƒç”¨delegateé‡Œé¢çš„numberOfViewsForHorizontalScrollerï¼ˆï¼‰ã€‚HorizontalScrollerå®ä¾‹æ²¡æœ‰å…³äºdelegateçš„ä¿¡æ¯ï¼Œè€Œæ˜¯çŸ¥é“å®ƒå¯ä»¥å®‰å…¨åœ°ä¼ é€’æ¶ˆæ¯ï¼Œå› ä¸ºdelegateå¿…é¡»éµä»HorizontalScrollerDelegateåè®®ã€‚<br />
å¯¹äºåœ¨scroll viewé‡Œçš„æ¯ä¸€ä¸ªviewç”¨ä¸€ä¸ªç‚¹å‡»æµ‹è¯•CGRectContainsPointæ‰¾åˆ°è¢«è§¦æ‘¸çš„viewã€‚å½“æ‰¾åˆ°äº†è¿™ä¸ªviewï¼Œè°ƒç”¨horizontalScrollerClickedViewAtIndexæ–¹æ³•ã€‚åœ¨æ‰“ç ´forå¾ªç¯ä¹‹å‰ï¼Œè§¦æ‘¸scroll viewé‡Œçš„viewã€‚<br />
ç°åœ¨æ·»åŠ reloadåˆ°scrolleré‡Œé¢ï¼š  </p>
<div class="highlight"><pre><span class="kd">func</span> <span class="nf">reload</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 1 - Check if there is a delegate, if not there is nothing to load.</span>
    <span class="k">if</span> <span class="kd">let</span> <span class="nv">delegate</span> <span class="p">=</span> <span class="n">delegate</span> <span class="p">{</span>
      <span class="c1">//2 - Will keep adding new album views on reload, need to reset.</span>
      <span class="n">viewArray</span> <span class="p">=</span> <span class="p">[]</span>
      <span class="kd">let</span> <span class="nv">views</span><span class="p">:</span> <span class="bp">NSArray</span> <span class="p">=</span> <span class="n">scroller</span><span class="p">.</span><span class="n">subviews</span>
            <span class="c1">// 3 - remove all subviews</span>
            <span class="k">for</span> <span class="n">view</span> <span class="k">in</span> <span class="n">views</span> <span class="p">{</span>
                <span class="n">view</span><span class="p">.</span><span class="n">removeFromSuperview</span><span class="p">()</span>
            <span class="p">}</span>
      <span class="c1">// 4 - xValue is the starting point of the views inside the scroller</span>
      <span class="kd">var</span> <span class="nv">xValue</span> <span class="p">=</span> <span class="n">VIEWS_OFFSET</span>
      <span class="k">for</span> <span class="n">index</span> <span class="k">in</span> <span class="mf">0.</span><span class="p">.&lt;</span><span class="n">delegate</span><span class="p">.</span><span class="n">numberOfViewsForHorizontalScroller</span><span class="p">(</span><span class="kc">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 5 - add a view at the right position</span>
        <span class="n">xValue</span> <span class="o">+=</span> <span class="n">VIEW_PADDING</span>
        <span class="kd">let</span> <span class="nv">view</span> <span class="p">=</span> <span class="n">delegate</span><span class="p">.</span><span class="n">horizontalScrollerViewAtIndex</span><span class="p">(</span><span class="kc">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">index</span><span class="p">)</span>
        <span class="n">view</span><span class="p">.</span><span class="n">frame</span> <span class="p">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">(</span><span class="n">xValue</span><span class="p">),</span> <span class="n">CGFloat</span><span class="p">(</span><span class="n">VIEW_PADDING</span><span class="p">),</span> <span class="n">CGFloat</span><span class="p">(</span><span class="n">VIEW_DIMENSIONS</span><span class="p">),</span> <span class="n">CGFloat</span><span class="p">(</span><span class="n">VIEW_DIMENSIONS</span><span class="p">))</span>
        <span class="n">scroller</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
        <span class="n">xValue</span> <span class="o">+=</span> <span class="n">VIEW_DIMENSIONS</span> <span class="o">+</span> <span class="n">VIEW_PADDING</span>
        <span class="c1">// 6 - Store the view so we can reference it later</span>
        <span class="n">viewArray</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="c1">// 7</span>
      <span class="n">scroller</span><span class="p">.</span><span class="n">contentSize</span> <span class="p">=</span> <span class="n">CGSizeMake</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">(</span><span class="n">xValue</span> <span class="o">+</span> <span class="n">VIEWS_OFFSET</span><span class="p">),</span> <span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">)</span>
      <span class="c1">// 8 - If an initial view is defined, center the scroller on it</span>
      <span class="k">if</span> <span class="kd">let</span> <span class="nv">initialView</span> <span class="p">=</span> <span class="n">delegate</span><span class="p">.</span><span class="n">initialViewIndex</span><span class="p">?(</span><span class="kc">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">scroller</span><span class="p">.</span><span class="n">setContentOffset</span><span class="p">(</span><span class="bp">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">CGFloat</span><span class="p">(</span><span class="n">initialView</span><span class="p">)</span><span class="o">*</span><span class="n">CGFloat</span><span class="p">((</span><span class="n">VIEW_DIMENSIONS</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">VIEW_PADDING</span><span class="p">))),</span> <span class="n">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">),</span> <span class="n">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
</pre></div>


<p>reloadæ–¹æ³•æ˜¯åœ¨UITableViewé‡æ–°åŠ è½½æ•°æ®ä»¥åè®¾è®¡çš„æ¨¡å‹ï¼›å®ƒé‡æ–°åŠ è½½äº†ç”¨äºæ„å»ºhorizontal scrollerçš„æ‰€æœ‰æ•°æ®ã€‚<br />
å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š<br />
1.åœ¨æˆ‘ä»¬åšä»»ä½•ä¸€ä¸ªreloadä¹‹å‰ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸€ä¸ªdelegateã€‚<br />
2.å³ä½¿ä½ æ¸…é™¤äº†ç›¸å†Œå°é¢ï¼Œä½ ä¹Ÿéœ€è¦é‡ç½®viewArrayã€‚å¦åˆ™ï¼Œå°†ä¼šæœ‰å¤§é‡çš„æ•°æ®ä»ä¹‹å‰çš„å°é¢é‡Œç•™å­˜ä¸‹æ¥ã€‚<br />
3.åœ¨æ·»åŠ åˆ°scroller viewä¹‹å‰ï¼Œç§»é™¤æ‰€æœ‰çš„subviewã€‚<br />
4.æ‰€æœ‰viewçš„åˆå§‹ä½ç½®éƒ½æ˜¯ç”±ç»™å®šçš„offsetå®šä½çš„ï¼Œå½“å‰æ˜¯100ï¼Œä½†æ˜¯å®ƒå¯ä»¥é€šè¿‡ä¿®æ”¹æ–‡ä»¶å¼€å§‹çš„VIEW_OFFETçš„å†…å®¹å¾ˆå®¹æ˜“çš„è¿›è¡Œæ‹‰ä¼¸ã€‚<br />
5.HorizontalViewè¦æ±‚å®ƒçš„delegate æŒ‰ç…§è®¾å®šå¥½çš„paddingä¸€æ¬¡ä¸€ä¸ªviewæ°´å¹³çš„ä¾æ¬¡æ‘†æ”¾ã€‚<br />
6.å°†viewå­˜åˆ°viewArrayé‡Œé¢ä»¥è¿½è¸ªscrollviewé‡Œæ‰€æœ‰viewçš„è¸ªè¿¹ã€‚<br />
7.ä¸€æ—¦æ‰€æœ‰çš„viewå°±ä½ä»¥åï¼Œä¸ºscroll viewè®¾ç½®content offsetæ¥ä½¿ç”¨æˆ·å¯ä»¥åœ¨æ‰€æœ‰çš„ç›¸å†Œå°é¢ä¹‹é—´æ»‘åŠ¨ã€‚<br />
8.horizontalscroller æ£€æŸ¥å®ƒçš„delegateæ˜¯å¦æ‰§è¡Œäº†initialviewindexæ–¹æ³•ã€‚è¿™ä¸€æ­¥æ£€æŸ¥æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå› ä¸ºç‰¹æ®Šåè®®æ–¹æ³•æ˜¯å¯é€‰çš„ã€‚å¦‚æœdelegateæ²¡æœ‰ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œé»˜è®¤å€¼å°±æ˜¯0ã€‚æœ€ç»ˆï¼Œè¿™æ®µä»£ç è®¾ç½®scroll view åˆ°ç”±delegateå®šä¹‰çš„åˆå§‹è§†å›¾çš„ä¸­å¿ƒã€‚<br />
å½“æ•°æ®æ”¹å˜æ—¶ï¼Œæ‰§è¡Œreloadæ–¹æ³•ã€‚å½“ä½ æ·»åŠ horizontalscrolleråˆ°å…¶ä»–çš„viewæ—¶ä¹Ÿéœ€è¦è¿™ä¸ªæ–¹æ³•ã€‚å°†å¦‚ä¸‹ä»£ç æ·»åŠ åˆ°HorizontalView.swiftï¼š  </p>
<div class="highlight"><pre><span class="kr">override</span> <span class="kd">func</span> <span class="nf">didMoveToSuperview</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">reload</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>


<p>didMoveToSuperviewæ˜¯ä¸€ä¸ªviewåœ¨è¢«æ·»åŠ åˆ°å¦ä¸€ä¸ªviewä½œä¸ºå­è§†å›¾æ—¶è¢«è°ƒç”¨çš„ã€‚è¿™æ­£æ˜¯é‡æ–°åŠ è½½scrollerå†…å®¹çš„å¥½æ—¶æœºã€‚<br />
å…³äºHorizontalScrolleræœ€åçš„ä¸€ä¸ªéš¾ç‚¹å°±æ˜¯è¦ç¡®å®šä½ æ­£åœ¨æµè§ˆçš„ç›¸å†Œæ€»æ˜¯åœ¨scrollerviewçš„å†…éƒ¨ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œå½“ç”¨æˆ·ç”¨æ‰‹æŒ‡æ‹–æ‹½scrollçš„æ—¶å€™ä½ éœ€è¦åšä¸€äº›è®¡ç®—ã€‚<br />
æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š  </p>
<div class="highlight"><pre><span class="kd">func</span> <span class="nf">centerCurrentView</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">xFinal</span> <span class="p">=</span> <span class="nb">Int</span><span class="p">(</span><span class="n">scroller</span><span class="p">.</span><span class="n">contentOffset</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">VIEWS_OFFSET</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">VIEW_PADDING</span>
    <span class="kd">let</span> <span class="nv">viewIndex</span> <span class="p">=</span> <span class="n">xFinal</span> <span class="o">/</span> <span class="p">(</span><span class="n">VIEW_DIMENSIONS</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">VIEW_PADDING</span><span class="p">))</span>
    <span class="n">xFinal</span> <span class="p">=</span> <span class="n">viewIndex</span> <span class="o">*</span> <span class="p">(</span><span class="n">VIEW_DIMENSIONS</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">VIEW_PADDING</span><span class="p">))</span>
        <span class="n">scroller</span><span class="p">.</span><span class="n">setContentOffset</span><span class="p">(</span><span class="bp">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">xFinal</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">),</span> <span class="n">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
    <span class="k">if</span> <span class="kd">let</span> <span class="nv">delegate</span> <span class="p">=</span> <span class="n">delegate</span> <span class="p">{</span>
      <span class="n">delegate</span><span class="p">.</span><span class="n">horizontalScrollerClickedViewAtIndex</span><span class="p">(</span><span class="kc">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">Int</span><span class="p">(</span><span class="n">viewIndex</span><span class="p">))</span>
    <span class="p">}</span>  
 <span class="p">}</span>
</pre></div>


<p>ä¸Šé¢çš„ä»£ç æ—¶ä¸ºäº†è®¡ç®—å½“å‰viewåˆ°ä¸­å¿ƒçš„è·ç¦»ï¼Œæ‰€ä»¥è¦è€ƒè™‘åˆ°å½“å‰scroll viewçš„offsetï¼Œå°ºå¯¸å’Œviewçš„paddingã€‚æœ€åä¸€è¡Œæ˜¯å¾ˆé‡è¦çš„ï¼Œä¸€æ—¦viewå±…ä¸­äº†ï¼Œç„¶åä½ å°±é€šçŸ¥delegateé€‰ä¸­çš„viewæ”¹å˜äº†ã€‚<br />
ä¸ºäº†æ¢æµ‹åˆ°ç”¨æˆ·åœ¨scroll viewé‡Œé¢ç»“æŸæ‹–åŠ¨ï¼Œä½ éœ€è¦ä½¿ç”¨ä¸€äº›UIScrollViewDelegateæ–¹æ³•ã€‚æ·»åŠ å¦‚ä¸‹ç±»æ‹“å±•ï¼Œè®°ä½è¦æ·»åŠ åœ¨ç±»çš„å¤§æ‹¬å·å¤–é¢ï¼  </p>
<div class="highlight"><pre><span class="kd">extension</span> <span class="nc">HorizontalScroller</span><span class="p">:</span> <span class="bp">UIScrollViewDelegate</span> <span class="p">{</span>
  <span class="kd">func</span> <span class="nf">scrollViewDidEndDragging</span><span class="p">(</span><span class="n">scrollView</span><span class="p">:</span> <span class="bp">UIScrollView</span><span class="p">,</span> <span class="n">willDecelerate</span> <span class="n">decelerate</span><span class="p">:</span> <span class="nb">Bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="o">!</span><span class="n">decelerate</span> <span class="p">{</span>
      <span class="n">centerCurrentView</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">func</span> <span class="nf">scrollViewDidEndDecelerating</span><span class="p">(</span><span class="n">scrollView</span><span class="p">:</span> <span class="bp">UIScrollView</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">centerCurrentView</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>scrollViewDidEndDragging(_:willDecelerate:)å½“ç”¨æˆ·ç»“æŸæ‹–åŠ¨æ—¶é€šçŸ¥delegateã€‚å¦‚æœscroll view æ²¡æœ‰å®Œå…¨åœæ­¢åˆ™å‡é€Ÿå‚æ•°ä¸ºçœŸã€‚å½“scrollåŠ¨ä½œåœæ­¢äº†ï¼Œç³»ç»Ÿå°†ä¼šè°ƒç”¨scrollViewDidEndDeceleratingã€‚è¿™ä¸¤ç§æƒ…å†µä½ éƒ½éœ€è¦è°ƒç”¨æ–°æ–¹æ³•ä½¿å½“å‰çš„viewå±…ä¸­ï¼Œå³ä½¿å½“å‰çš„è¯•å›¾å¯èƒ½åœ¨ç”¨æˆ·çš„æ‹–æ‹½scroll viewæ—¶æ”¹å˜äº†ã€‚<br />
å·¦åä¸è¦å¿˜äº†è®¾ç½®delegateã€‚åœ¨initializeScrollViewï¼ˆï¼‰é‡Œé¢çš„scroller = UIScrollView():åé¢æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š </p>
<div class="highlight"><pre><span class="n">scroller</span><span class="p">.</span><span class="n">delegate</span> <span class="p">=</span> <span class="kc">self</span><span class="p">;</span>
</pre></div>


<p>HorizontalScrollerå·²ç»ç­‰ç€ä½ ä½¿ç”¨äº†ï¼æµè§ˆä½ åˆšæ‰å†™çš„ä»£ç ä½ ä¼šå‘ç°ï¼›ä½ ä¸€ç‚¹ä¹Ÿæ²¡æœ‰æåˆ°Albumç±»æˆ–AlbumViewç±»ã€‚è¿™å¤ªæ£’äº†ï¼Œå› ä¸ºè¿™æ„å‘³ç€æ–°çš„scrollerçœŸæ­£çš„å®ç°äº†ç‹¬ç«‹å’Œé‡ç”¨ã€‚<br />
buildä½ çš„å·¥ç¨‹ç¡®ä¿æ¯ä¸€ä»¶äº‹éƒ½å®Œç¾å®Œæˆã€‚<br />
ç°åœ¨HorizontalScroller å·²ç»å®Œæˆäº†ï¼Œæ˜¯æ—¶å€™åœ¨ä½ çš„appé‡Œé¢ä½¿ç”¨äº†ã€‚é¦–å…ˆï¼Œæ‰“å¼€main.storyboard.ç‚¹å‡»é¡¶éƒ¨çš„ç°è‰²çŸ©å½¢è§†å›¾ï¼Œå¹¶ä¸”ç‚¹å‡» identity inspectorã€‚ç”¨å¦‚ä¸‹æ“ä½œä¿®æ”¹ç±»åã€‚<br />
<div align=center>
<img src="http://www.raywenderlich.com/wp-content/uploads/2014/11/swiftDesignPattwern9.png" width="640" height="430" alt="ä¿®æ”¹ç±»åæ•ˆæœå›¾"/>
</div> 
æ¥ä¸‹æ¥ï¼Œæ‰“å¼€assistant editoræŒ‰ä½controlä»ç°è‰²çŸ©å½¢è§†å›¾æ‹–åŠ¨åˆ°ViewController.swiftåˆ›å»ºä¸€ä¸ªoutletå‘½åä¸ºscrollerï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br />
<div align=center>
<img src="http://www.raywenderlich.com/wp-content/uploads/2014/11/swiftDesignPattern10.png" width="640" height="430" alt="æ‹–åŠ¨æ•ˆæœå›¾"/>
</div> 
ä¸‹ä¸€æ­¥ï¼Œæ‰“å¼€ViewController.swiftã€‚æ˜¯æ—¶å€™ä½¿ç”¨ä¸€äº›HorizontalScrollerDelegateæ–¹æ³•äº†ã€‚
åœ¨æ–‡ä»¶åº•éƒ¨æ·»åŠ å¦‚ä¸‹æ‰©å±•ï¼š  </p>
<div class="highlight"><pre><span class="kd">extension</span> <span class="nc">ViewController</span><span class="p">:</span> <span class="n">HorizontalScrollerDelegate</span> <span class="p">{</span>
  <span class="kd">func</span> <span class="nf">horizontalScrollerClickedViewAtIndex</span><span class="p">(</span><span class="n">scroller</span><span class="p">:</span> <span class="n">HorizontalScroller</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//1</span>
    <span class="kd">let</span> <span class="nv">previousAlbumView</span> <span class="p">=</span> <span class="n">scroller</span><span class="p">.</span><span class="n">viewAtIndex</span><span class="p">(</span><span class="n">currentAlbumIndex</span><span class="p">)</span> <span class="kc">as</span><span class="p">!</span> <span class="n">AlbumView</span>
    <span class="n">previousAlbumView</span><span class="p">.</span><span class="n">highlightAlbum</span><span class="p">(</span><span class="n">didHighlightView</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
    <span class="c1">//2</span>
    <span class="n">currentAlbumIndex</span> <span class="p">=</span> <span class="n">index</span>
    <span class="c1">//3</span>
    <span class="kd">let</span> <span class="nv">albumView</span> <span class="p">=</span> <span class="n">scroller</span><span class="p">.</span><span class="n">viewAtIndex</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="kc">as</span><span class="p">!</span> <span class="n">AlbumView</span>
    <span class="n">albumView</span><span class="p">.</span><span class="n">highlightAlbum</span><span class="p">(</span><span class="n">didHighlightView</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
    <span class="c1">//4</span>
    <span class="n">showDataForAlbum</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>è®©æˆ‘ä»¬å†ä¸€è¡Œä¸€è¡Œçš„èµ°ä¸€édelegateæ–¹æ³•ï¼š<br />
1.é¦–å…ˆï¼ŒæŠ“å–ä¹‹å‰é€‰å®šçš„ç›¸å†Œï¼Œä¸é€‰å®šç›¸å†Œå°é¢ã€‚<br />
2.å­˜å‚¨å½“å‰ä½ ç‚¹å‡»çš„ç›¸å†Œå°é¢çš„åºå·ã€‚<br />
3.æŠ“å–å½“å‰é€‰å®šçš„ç›¸å†Œå°é¢å¹¶ä¸”ä½¿å®ƒé«˜äº®é€‰ä¸­ã€‚<br />
4.åœ¨tableviewä¸­æ˜¾ç¤ºæ–°çš„ç›¸å†Œçš„æ•°æ®ã€‚
æ¥ä¸‹æ¥ï¼Œæ·»åŠ å¦‚ä¸‹æ‰©å±•æ–¹æ³•ï¼š  </p>
<div class="highlight"><pre><span class="kd">func</span> <span class="nf">numberOfViewsForHorizontalScroller</span><span class="p">(</span><span class="n">scroller</span><span class="p">:</span> <span class="n">HorizontalScroller</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="p">(</span><span class="nb">Int</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">allAlbums</span><span class="p">.</span><span class="bp">count</span>
<span class="p">}</span>
</pre></div>


<p>è¿™ä¸ªæ–¹æ³•å°±åƒä½ æƒ³çš„ä¸€æ ·ï¼Œæ˜¯ä¸€ä¸ªè¿”å›scroll viewé‡Œviewæ•°é‡çš„ä¸€ä¸ªåè®®æ–¹æ³•ã€‚å› ä¸ºscroll viewå°†ä¼šæ˜¾ç¤ºæ‰€æœ‰ç›¸å†Œæ•°æ®çš„å°é¢ï¼Œè¿™ä¸ªå€¼æ˜¯ç›¸å†Œè®°å½•çš„æ•°é‡ã€‚<br />
ç°åœ¨æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š  </p>
<div class="highlight"><pre><span class="kd">func</span> <span class="nf">horizontalScrollerViewAtIndex</span><span class="p">(</span><span class="n">scroller</span><span class="p">:</span> <span class="n">HorizontalScroller</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="p">(</span><span class="bp">UIView</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">album</span> <span class="p">=</span> <span class="n">allAlbums</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="kd">let</span> <span class="nv">albumView</span> <span class="p">=</span> <span class="n">AlbumView</span><span class="p">(</span><span class="n">frame</span><span class="p">:</span> <span class="bp">CGRect</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="mi">100</span><span class="p">),</span> <span class="n">albumCover</span><span class="p">:</span> <span class="n">album</span><span class="p">.</span><span class="n">coverUrl</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">currentAlbumIndex</span> <span class="p">==</span> <span class="n">index</span> <span class="p">{</span>
      <span class="n">albumView</span><span class="p">.</span><span class="n">highlightAlbum</span><span class="p">(</span><span class="n">didHighlightView</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">albumView</span><span class="p">.</span><span class="n">highlightAlbum</span><span class="p">(</span><span class="n">didHighlightView</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">albumView</span>
  <span class="p">}</span>
</pre></div>


<p>åœ¨è¿™é‡Œåˆ›å»ºä¸€ä¸ªæ–°çš„AlbumViewï¼Œæ¥ä¸‹æ¥ç‚¹å‡»è¯•ä¸€ä¸‹ç”¨æˆ·æ˜¯å¦é€‰ä¸­äº†è¿™ä¸ªç›¸å†Œã€‚ç„¶åå°±å¯ä»¥æ ¹æ®ç›¸å†Œæ˜¯å¦è¢«é€‰ä¸­è®¾ç½®ä¸ºé«˜äº®æ˜¾ç¤ºæˆ–ä¸é«˜äº®ã€‚æœ€åä¼ é€’ç»™HorizontalScrollerã€‚<br />
è¿™å°±å¥½äº†ï¼ä»…ä»…ä¸‰ä¸ªç®€å•çš„æ–¹æ³•å°±èƒ½å®ç°ä¸€ä¸ªå¥½çœ‹çš„æ°´å¹³æ»‘åŠ¨çª—å£ã€‚<br />
æ˜¯çš„ï¼Œä½ è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªscrollerå¹¶æŠŠå®ƒæ·»åŠ åˆ°ä½ çš„ä¸»viewä¸­ï¼Œä½†æ˜¯åœ¨ä½ åšè¿™ä¸ªä¹‹å‰ï¼Œæ·»åŠ å¦‚ä¸‹æ–¹æ³•åˆ°ä¸»ç±»ï¼š  </p>
<div class="highlight"><pre><span class="kd">func</span> <span class="nf">reloadScroller</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">allAlbums</span> <span class="p">=</span> <span class="n">LibraryAPI</span><span class="p">.</span><span class="n">sharedInstance</span><span class="p">.</span><span class="n">getAlbums</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">currentAlbumIndex</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">{</span>
      <span class="n">currentAlbumIndex</span> <span class="p">=</span> <span class="mi">0</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">currentAlbumIndex</span> <span class="o">&gt;=</span> <span class="n">allAlbums</span><span class="p">.</span><span class="bp">count</span> <span class="p">{</span>
      <span class="n">currentAlbumIndex</span> <span class="p">=</span> <span class="n">allAlbums</span><span class="p">.</span><span class="bp">count</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="p">}</span>
    <span class="n">scroller</span><span class="p">.</span><span class="n">reload</span><span class="p">()</span>
    <span class="n">showDataForAlbum</span><span class="p">(</span><span class="n">currentAlbumIndex</span><span class="p">)</span>
  <span class="p">}</span>
</pre></div>


<p>è¿™ä¸ªæ–¹æ³•é€šè¿‡LibraryAPIé‡æ–°åŠ è½½ç›¸å†Œæ•°æ®ï¼Œå¹¶ä¸”åŸºäºå½“å‰viewçš„åºå·å€¼æ˜¾ç¤ºå½“å‰çš„viewã€‚å¦‚æœå½“å‰çš„viewåºå·å°äº0ï¼Œæ„å‘³ç€ç°åœ¨æ²¡æœ‰viewè¢«é€‰ä¸­ï¼Œç„¶åæ˜¾ç¤ºlistä¸­çš„ç¬¬ä¸€ä¸ªç›¸å†Œã€‚å¦åˆ™ï¼Œæ˜¾ç¤ºæœ€åä¸€ä¸ªç›¸å†Œã€‚<br />
ç°åœ¨ï¼Œé€šè¿‡åœ¨viewDidLoadçš„æœ€åæ·»åŠ å¦‚ä¸‹ä»£ç åˆå§‹åŒ–scrollerï¼š  </p>
<div class="highlight"><pre><span class="n">scroller</span><span class="p">.</span><span class="n">delegate</span> <span class="p">=</span> <span class="kc">self</span>
<span class="n">reloadScroller</span><span class="p">()</span>
</pre></div>


<p>æ—¢ç„¶HorizontalScrolleråœ¨storyboardä¸­åˆ›å»ºï¼Œä½ æ‰€è¦åšçš„äº‹æƒ…æœ‰ï¼šè®¾ç½®delegateï¼Œè°ƒç”¨reloadScrollerï¼ˆï¼‰æ¥ä¸ºscrolleråŠ è½½subviewä»¥æ˜¾ç¤ºç›¸å†Œæ•°æ®ã€‚  </p>
<div class="highlight"><pre>    æ³¨æ„ï¼šå¦‚æœä¸€ä¸ªåè®®å˜å¾—å¾ˆå¤§å¹¶ä¸”æœ‰å¾ˆå¤šå¯é€‰çš„æ–¹æ³•ï¼Œä½ å°±è¦è€ƒè™‘æŠŠå®ƒæ‹†æˆå‡ ä¸ªå°çš„åè®®ã€‚UITableViewDelegate and UITableViewDataSourceå°±æ˜¯å¾ˆå¥½çš„ä¾‹å­ã€‚è¯•ç€è®¾è®¡ä½ çš„åè®®ï¼Œè¿™æ ·æ¯ä¸€ä¸ªåè®®å¤„ç†ä¸€ä¸ªå…·ä½“çš„åŠŸèƒ½åŒºåŸŸã€‚
</pre></div>


<p>ç¼–è¯‘è¿è¡Œä½ çš„é¡¹ç›®ï¼Œç„¶åå°±èƒ½çœ‹åˆ°ä½ ç¾å¥½çš„æ°´å¹³æ»‘åŠ¨çª—å£ã€‚<br />
<div align=center>
<img src="http://www.raywenderlich.com/wp-content/uploads/2014/11/swiftDesignPattern12.png" width="360" height="430" alt="åˆå§‹æ•ˆæœå›¾"/>
</div> 
å“ˆå“ˆï¼ŒğŸ˜„ğŸ˜„ğŸ˜„ã€‚ç­‰ç­‰ï¼Œæ°´å¹³æ»‘åŠ¨çª—å£æœ‰äº†ï¼Œå¯æ˜¯å°é¢å»å“ªå„¿äº†ï¼Ÿ<br />
æ˜¯çš„ï¼Œä½ è¿˜æ²¡æœ‰å†™ç”¨æ¥åŠ è½½å°é¢çš„ä»£ç ã€‚ä½ éœ€è¦æ·»åŠ ä¸€ä¸ªä¸‹è½½å›¾ç‰‡çš„æ–¹æ³•ã€‚å› ä¸ºï¼Œä½ æ‰€æœ‰çš„å­˜å–æœåŠ¡éƒ½æ˜¯é€šè¿‡LibraryAPIã€‚è¿™å°±æ˜¯æ–°çš„æ–¹æ³•è¦åšçš„äº‹æƒ…ã€‚ç„¶è€Œï¼Œåœ¨è¿™ä¹‹å‰è¿˜æœ‰ä¸€äº›äº‹æƒ…éœ€è¦è€ƒè™‘ï¼š<br />
1.AlbumViewä¸åº”è¯¥ç›´æ¥ä½¿ç”¨LibraryAPIã€‚ä½ ä¸æƒ³å°†è§†å›¾é€»è¾‘å’Œäº¤äº’é€»è¾‘æ··åˆã€‚<br />
2.å‡ºäºç›¸åŒçš„ç†ç”±ï¼ŒLibraryAPIä¸åº”è¯¥çŸ¥é“AlbumViewã€‚<br />
3.ä¸€æ—¦å°é¢ä¸‹è½½å®Œæˆï¼ŒLibraryAPIéœ€è¦å‘ŠçŸ¥AlbumViewï¼Œå› ä¸ºAlbumViewéœ€è¦æ˜¾ç¤ºå°é¢ã€‚<br />
å¬èµ·æ¥æ˜¯ä¸æ˜¯å¾ˆå¤æ‚ï¼Ÿä¸è¦æ‹…å¿ƒï¼Œæ¥ä¸‹æ¥ä½ å°†ä¼šå­¦ä¹ è§‚å¯Ÿè€…æ¨¡å¼ï¼ğŸ˜„  </p>
<h1>The Observer Pattern</h1>
<p>åœ¨è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œä¸€ä¸ªå¯¹è±¡é€šçŸ¥å…¶ä»–çš„å¯¹è±¡æ‰€æœ‰å…³äºçŠ¶æ€çš„æ”¹å˜ã€‚å‚ä¸å¯¹è±¡ä¸éœ€è¦çŸ¥é“å½¼æ­¤ï¼å°½ç®¡æ”¯æŒæ¾è€¦åˆã€‚è¿™äº›æ¨¡å¼å¤§å¤šæ•°ç”¨äºæ„Ÿå…´è¶£çš„å¯¹è±¡ï¼Œå½“å±æ€§å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ã€‚<br />
é€šå¸¸çš„åšæ³•æ˜¯éœ€è¦ä¸€ä¸ªè§‚å¯Ÿç™»è®°å‘˜å¯¹å¦ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€æ„Ÿå…´è¶£ã€‚å½“çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰çš„è§‚å¯Ÿå¯¹è±¡éƒ½ä¼šè¢«é€šçŸ¥ã€‚<br />
å¦‚æœä½ æƒ³ä¾ç…§MVCæ¦‚å¿µï¼Œä½ éœ€è¦Modelå¯¹è±¡ä¸Viewå¯¹è±¡äº¤äº’ï¼Œä½†ä¸æ˜¯ç›´æ¥åœ¨ä¸¤è€…ä¹‹é—´äº¤äº’ã€‚è¿™å°±äº§ç”Ÿäº†è§‚å¯Ÿè€…æ¨¡å¼ã€‚<br />
Cocoaç”¨ä¸¤ç§ç›¸ä¼¼çš„æ–¹æ³•ä½¿ç”¨äº†è§‚å¯Ÿè€…æ¨¡å¼ï¼šNotifications å’Œ Key-Value Observingã€‚  </p>
<h2>Notifications</h2>
<p>ä¸è¦å°†å®ƒä¸æ¨é€å’Œæœ¬åœ°é€šçŸ¥æ··æ·†ï¼ŒNotificationæ˜¯åŸºäºsubscribe-and-publishæ¨¡å‹ï¼Œè¿™ä¸ªæ¨¡å‹å…è®¸ä¸€ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯ç»™å…¶ä»–çš„å¯¹è±¡ã€‚å‡ºç‰ˆå•†æ°¸è¿œä¸å¿…çŸ¥é“å…³äºè®¢è´­è€…çš„ä»»ä½•æ¶ˆæ¯ã€‚<br />
Notificationåœ¨Appleä¸­å¹¿æ³›ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œé”®ç›˜æ˜¾ç¤ºæˆ–éšè—æ—¶ï¼Œç³»ç»Ÿå‘é€ä¸€ä¸ªUIKeyboardWillShowNotification/UIKeyboardWillHideNotificationï¼Œå½“ä½ çš„ç¨‹åºè¿›å…¥åå°æ—¶ï¼Œç³»ç»Ÿå‘é€ä¸€ä¸ªUIApplicationDidEnterBackgroundNotificationã€‚  </p>
<div class="highlight"><pre>    æ³¨æ„ï¼šæ‰“å¼€UIApplication.swift,åœ¨æ–‡æ¡£çš„æœ«å°¾ï¼Œä½ ä¼šçœ‹è§è‡³å°‘20ä¸ªç”±ç³»ç»Ÿå‘å‡ºçš„notificationsã€‚
</pre></div>


<h2>How to Use Notifations</h2>
<p>æ‰“å¼€AlbumView.swiftåœ¨initï¼ˆï¼‰åé¢æ’å…¥å¦‚ä¸‹ä»£ç ï¼š  </p>
<div class="highlight"><pre><span class="bp">NSNotificationCenter</span><span class="p">.</span><span class="n">defaultCenter</span><span class="p">().</span><span class="n">postNotificationName</span><span class="p">(</span><span class="s">&quot;BLDownloadImageNotification&quot;</span><span class="p">,</span> <span class="n">object</span><span class="p">:</span> <span class="kc">self</span><span class="p">,</span> <span class="n">userInfo</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;imageView&quot;</span><span class="p">:</span><span class="n">coverImage</span><span class="p">,</span> <span class="s">&quot;coverUrl&quot;</span> <span class="p">:</span> <span class="n">albumCover</span><span class="p">])</span>
</pre></div>


<p>è¿™ä¸€è¡Œä»£ç é€šè¿‡NSNotifacationCenterå•ä¾‹æ¥å‘é€ä¸€ä¸ªnotificationã€‚é€šçŸ¥ä¿¡æ¯åŒ…æ‹¬UIImageviewå’Œå°†è¦ä¸‹è½½çš„å°é¢ä¿¡æ¯çš„URLã€‚è¿™æ˜¯æ‰€æœ‰ä½ éœ€è¦çš„å®Œæˆå°é¢ä¸‹è½½ä»»åŠ¡çš„ä¿¡æ¯ã€‚<br />
ç›´æ¥åœ¨super.init()åæ·»åŠ å¦‚ä¸‹ä¸€è¡Œåˆå§‹åŒ–LibraryAPI.swiftï¼š  </p>
<div class="highlight"><pre><span class="bp">NSNotificationCenter</span><span class="p">.</span><span class="n">defaultCenter</span><span class="p">().</span><span class="n">addObserver</span><span class="p">(</span><span class="kc">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span><span class="s">&quot;downloadImage:&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="s">&quot;BLDownloadImageNotification&quot;</span><span class="p">,</span> <span class="n">object</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
</pre></div>


<p>è¿™å°±æ˜¯æ–¹ç¨‹çš„å¦ä¸€é¢ï¼šè§‚å¯Ÿè€…ã€‚æ¯æ¬¡AlbumViewç±»å‘å‡ºä¸€ä¸ªBLDownloadImageNotification é€šçŸ¥æ—¶ï¼Œå› ä¸ºLibraryAPIå·²ç»ç™»è®°ä¸ºä¸ºäº†ç›¸åŒé€šçŸ¥çš„è§‚å¯Ÿè€…ï¼Œç³»ç»Ÿé€šçŸ¥LibraryAPIã€‚ç„¶åLibraryAPIè°ƒç”¨downloadImageï¼ˆï¼‰ä½œä¸ºå›åº”ã€‚<br />
ç„¶è€Œï¼Œåœ¨ä½ ä½¿ç”¨downloadImageï¼ˆï¼‰ä¹‹å‰ï¼Œä½ å¿…é¡»è®°ä½å½“ç±»è¢«é‡Šæ”¾çš„æ—¶å€™ä½ è¦ä»é€šçŸ¥ä¸­å–æ¶ˆè®¢é˜…ã€‚å¦‚æœä½ ä¸ä»ä½ æ³¨å†Œçš„é€šçŸ¥ä¸­å–æ¶ˆè®¢é˜…ï¼Œé€šçŸ¥å¯èƒ½ä¼šé€åˆ°ä¸€ä¸ªé‡Šæ”¾çš„å®ä¾‹ã€‚è¿™å¯èƒ½å¯¼è‡´åº”ç”¨å†²çªã€‚<br />
åœ¨LibraryAPI.swiftä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š  </p>
<div class="highlight"><pre><span class="kd">deinit</span> <span class="p">{</span>
  <span class="bp">NSNotificationCenter</span><span class="p">.</span><span class="n">defaultCenter</span><span class="p">().</span><span class="n">removeObserver</span><span class="p">(</span><span class="kc">self</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>å½“å¯¹è±¡è¢«é‡Šæ”¾ï¼Œå®ƒå°†ä¼šä»æ‰€æœ‰ç™»è®°è¿‡çš„é€šçŸ¥ä¸­ç§»é™¤è§‚å¯Ÿè€…è‡ªå·±ã€‚<br />
è¿™å„¿è¿˜æœ‰ä¸€ä»¶äº‹æƒ…è¦åšã€‚å°†ä¸‹è½½çš„å°é¢ä¿å­˜åˆ°æœ¬åœ°æ˜¯ä¸€ä¸ªå¥½æ–¹æ³•ï¼Œè¿™æ ·appå°±ä¸ç”¨ä¸€éä¸€éåœ°ä¸‹è½½ç›¸åŒçš„å°é¢äº†ã€‚<br />
æ‰“å¼€PersistencyManager.swiftå¹¶ä¸”æ·»åŠ å¦‚ä¸‹æ–¹æ³•ï¼š  </p>
<div class="highlight"><pre><span class="kd">func</span> <span class="nf">getImage</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="bp">UIImage</span><span class="p">?</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nv">error</span><span class="p">:</span> <span class="bp">NSError</span><span class="p">?</span>
        <span class="kd">let</span> <span class="nv">path</span> <span class="p">=</span> <span class="n">NSHomeDirectory</span><span class="p">().</span><span class="n">stringByAppendingString</span><span class="p">(</span><span class="s">&quot;/Documents/</span><span class="si">\(</span><span class="n">filename</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nv">data</span> <span class="p">:</span> <span class="bp">NSData</span><span class="p">?</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="n">data</span> <span class="p">=</span> <span class="n">try</span> <span class="bp">NSData</span><span class="p">(</span><span class="n">contentsOfFile</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="p">.</span><span class="n">UncachedRead</span><span class="p">)</span>
        <span class="p">}</span> <span class="n">catch</span> <span class="kd">let</span> <span class="nv">error1</span> <span class="kc">as</span> <span class="bp">NSError</span> <span class="p">{</span>
            <span class="n">error</span> <span class="p">=</span> <span class="n">error1</span>
            <span class="n">data</span> <span class="p">=</span> <span class="kc">nil</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="kd">let</span> <span class="nv">unwrappedError</span> <span class="p">=</span> <span class="n">error</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="bp">UIImage</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">data</span><span class="p">!)</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>


<p>è¿™æ®µä»£ç ååˆ†çš„ç›´æ¥ï¼Œä¸‹è½½çš„å›¾ç‰‡å°†ä¼šå­˜å‚¨ç›´æ¥å­˜å‚¨åˆ°documentï¼Œå¦‚æœæ²¡æœ‰åœ¨documentä¸­æ‰¾åˆ°åŒ¹é…çš„æ–‡ä»¶ï¼ŒgetImageï¼ˆï¼‰ä¼šè¿”å›nilã€‚<br />
ç°åœ¨åœ¨LibraryAPI.swiftä¸­æ·»åŠ å¦‚ä¸‹æ–¹æ³•ï¼š  </p>
<div class="highlight"><pre>  <span class="kd">func</span> <span class="nf">downloadImage</span><span class="p">(</span><span class="n">notification</span><span class="p">:</span> <span class="bp">NSNotification</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//1</span>
    <span class="kd">let</span> <span class="nv">userInfo</span> <span class="p">=</span> <span class="n">notification</span><span class="p">.</span><span class="n">userInfo</span> <span class="kc">as</span><span class="p">!</span> <span class="p">[</span><span class="nb">String</span><span class="p">:</span> <span class="nb">AnyObject</span><span class="p">]</span>
    <span class="kd">var</span> <span class="nv">imageView</span> <span class="p">=</span> <span class="n">userInfo</span><span class="p">[</span><span class="s">&quot;imageView&quot;</span><span class="p">]</span> <span class="kc">as</span><span class="p">!</span> <span class="bp">UIImageView</span><span class="p">?</span>
    <span class="kd">let</span> <span class="nv">coverUrl</span> <span class="p">=</span> <span class="n">userInfo</span><span class="p">[</span><span class="s">&quot;coverUrl&quot;</span><span class="p">]</span> <span class="kc">as</span><span class="p">!</span> <span class="nb">String</span>
    <span class="c1">//2</span>
    <span class="k">if</span> <span class="kd">let</span> <span class="nv">imageViewUnWrapped</span> <span class="p">=</span> <span class="n">imageView</span> <span class="p">{</span>
      <span class="n">imageViewUnWrapped</span><span class="p">.</span><span class="n">image</span> <span class="p">=</span> <span class="n">persistencyManager</span><span class="p">.</span><span class="n">getImage</span><span class="p">(</span><span class="n">coverUrl</span><span class="p">.</span><span class="n">lastPathComponent</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">imageViewUnWrapped</span><span class="p">.</span><span class="n">image</span> <span class="p">==</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="c1">//3</span>
        <span class="n">dispatch_async</span><span class="p">(</span><span class="n">dispatch_get_global_queue</span><span class="p">(</span><span class="n">DISPATCH_QUEUE_PRIORITY_DEFAULT</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">{</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="nb">Void</span> <span class="k">in</span>
          <span class="kd">let</span> <span class="nv">downloadedImage</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">httpClient</span><span class="p">.</span><span class="n">downloadImage</span><span class="p">(</span><span class="n">coverUrl</span> <span class="kc">as</span> <span class="nb">String</span><span class="p">)</span>
          <span class="c1">//4</span>
          <span class="n">dispatch_sync</span><span class="p">(</span><span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="p">{</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="nb">Void</span> <span class="k">in</span>
            <span class="n">imageViewUnWrapped</span><span class="p">.</span><span class="n">image</span> <span class="p">=</span> <span class="n">downloadedImage</span>
            <span class="kc">self</span><span class="p">.</span><span class="n">persistencyManager</span><span class="p">.</span><span class="n">saveImage</span><span class="p">(</span><span class="n">downloadedImage</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">coverUrl</span><span class="p">.</span><span class="n">lastPathComponent</span><span class="p">)</span>
          <span class="p">})</span>
        <span class="p">})</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
</pre></div>


<p>ä¸‹é¢å°±æ˜¯ä»£ç ä¸­çš„æ–­ç‚¹ï¼š<br />
1.downloadImageæ˜¯é€šè¿‡é€šçŸ¥æ‰§è¡Œçš„ï¼Œæ‰€ä»¥æ–¹æ³•æ¥æ”¶é€šçŸ¥å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚UIImageViewå’Œå›¾åƒçš„URLä»é€šçŸ¥ä¸­å–å›ã€‚<br />
2.å¦‚æœä¹‹å‰å·²ç»ä¸‹è½½äº†å›¾åƒï¼Œç›´æ¥ä»PersistencyManageré‡Œå–å›å›¾åƒã€‚<br />
3.å¦‚æœå›¾åƒè¿˜æ²¡æœ‰è¢«ä¸‹è½½ï¼Œç”¨HTTPClientå–å›ã€‚<br />
4.å½“ä¸‹è½½å®Œæˆï¼Œåœ¨å›¾åƒçª—å£æ˜¾ç¤ºå›¾åƒï¼Œå¹¶ä¸”ç”¨PersistencyManagerä¿å­˜åˆ°æœ¬åœ°ã€‚<br />
åœ¨æ¬¡è¯´æ˜ï¼Œä½ æ­£åœ¨ä½¿ç”¨Facadeæ¨¡å¼éšè—ä»å…¶ä»–ç±»ä¸‹è½½å›¾ç‰‡çš„å¤æ‚ç»†èŠ‚ã€‚é€šçŸ¥å‘é€è€…ä¸å…³å¿ƒå›¾åƒæ˜¯æ¥è‡ªç½‘ç»œè¿˜æ˜¯æœ¬åœ°ã€‚<br />
ç¼–è¯‘è¿è¡Œä½ çš„ç¨‹åºï¼Œä½ å°±ä¼šåœ¨æ°´å¹³æ»‘åŠ¨çª—å£é‡Œé¢çœ‹åˆ°ç¾ä¸½çš„å°é¢ã€‚<br />
<div align=center>
<img src="http://www.raywenderlich.com/wp-content/uploads/2014/11/swiftDesignPattern13.png" width="360" height="430" alt="å¸¦å°é¢åˆå§‹æ•ˆæœå›¾"/>
</div> 
åœæ­¢é¡¹ç›®é‡æ–°è¿è¡Œï¼Œä½ å°†ä¼šå‘ç°ç°åœ¨æ¯«æ— å»¶è¿Ÿçš„åŠ è½½å°é¢ï¼Œå› ä¸ºå®ƒä»¬å·²ç»è¢«åŠ è½½åˆ°æœ¬åœ°äº†ã€‚ä½ ç”šè‡³å¯ä»¥æ–­ç½‘ï¼Œä½ çš„appè¿˜ä¼šæ­£å¸¸å·¥ä½œçš„ã€‚ç„¶è€Œè¿™å„¿æœ‰ä¸€ç‚¹éå¸¸å¤æ€ªï¼šè¿™ä¸ªè½¬åŠ¨è¿›åº¦å›¾ä¸æ–­çš„è½¬åŠ¨ï¼åˆ°åº•æ˜¯æ€ä¹ˆäº†ï¼Ÿ<br />
å½“ä½ ä¸‹è½½å›¾ç‰‡çš„æ—¶å€™å¼€å¯çš„æ—‹è½¬ï¼Œä½†ä½ æ²¡æœ‰åšå½“å›¾ç‰‡åŠ è½½å®Œæˆæ—¶åœæ­¢æ—‹è½¬çš„é€»è¾‘ã€‚æ¯æ¬¡ä½ å¯ä»¥åœ¨ä¸€ä¸ªå›¾ç‰‡ä¸‹è½½å®Œæˆæ—¶å‘å‡ºä¸€ä¸ªé€šçŸ¥ï¼Œä½†æ˜¯ä½œä¸ºæ›¿ä»£ï¼Œä½ å°†ä¼šä½ å°†ä¼šç”¨åˆ°å…¶ä»–çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼ŒKOVã€‚</p>
                </div><!-- /.entry-content -->
                <div class="comments">
                <h2>Comments !</h2>
                        <div id="disqus_thread"></div>
                        <script type="text/javascript">
                           var disqus_identifier = "articles/IOS.html";
                           (function() {
                                var dsq = document.createElement('script');
                                dsq.type = 'text/javascript'; dsq.async = true;
                                dsq.src = 'http://leelir.disqus.com/embed.js';
                                (document.getElementsByTagName('head')[0] ||
                                 document.getElementsByTagName('body')[0]).appendChild(dsq);
                          })();
                        </script>
                </div>
        </article>
</section>
        </div><!--/span-->

                <div class="span3 well sidebar-nav" id="sidebar">
<ul class="nav nav-list">
<li class="nav-header"><h4><i class="icon-external-link"></i>blogroll</h4></li>
    <li><a href="http://heylinux.com"><i class="icon-external-link"></i>HeyLinux</a></li>
<li class="nav-header"><h4><i class="icon-home icon-large"></i> social</h4></li>
<li><a href="https://leelir.github.io/" rel="alternate"><i class="icon-bookmark icon-large"></i>atom feed</a></li>
    <li><a href="https://github.com/leelir/leelir.github.com"><i class="icon-Github-sign icon-large"></i>Github</a></li>
    <li><a href="http://weibo.com/2372180553/profile?topnav=1&wvr=6"><i class="icon-sina-sign icon-large"></i>sina</a></li>

<li class="nav-header"><h4><i class="icon-folder-close icon-large"></i>Categories</h4></li>
<li>
<a href="https://leelir.github.io/category/diary.html">
    <i class="icon-folder-open icon-large"></i>diary
</a>
</li>
<li>
<a href="https://leelir.github.io/category/funny-things.html">
    <i class="icon-folder-open icon-large"></i>funny things
</a>
</li>
<li>
<a href="https://leelir.github.io/category/ios.html">
    <i class="icon-folder-open icon-large"></i>IOS
</a>
</li>
<li>
<a href="https://leelir.github.io/category/svn.html">
    <i class="icon-folder-open icon-large"></i>svn
</a>
</li>
<li>
<a href="https://leelir.github.io/category/work.html">
    <i class="icon-folder-open icon-large"></i>work
</a>
</li>

<li class="nav-header"><h4><i class="icon-tags icon-large"></i>Tags</h4></li>


</ul>        </div><!--/.well -->

      </div><!--/row-->

      <hr>

      <footer>
        <address id="about">
                Proudly powered by <a href="http://pelican.notmyidea.org/">Pelican <i class="icon-external-link"></i></a>,
                                which takes great advantage of <a href="http://python.org">Python <i class="icon-external-link"></i></a>.
        </address><!-- /#about -->

        <p>The theme is from <a href="http://twitter.github.com/bootstrap/">Bootstrap from Twitter <i class="icon-external-link"></i></a>,
                   and <a href="http://fortawesome.github.com/Font-Awesome/">Font-Awesome <i class="icon-external-link"></i></a>, thanks!</p>
      </footer>

    </div><!--/.fluid-container-->


<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
	var pageTracker = _gat._getTracker("UA-65525757-1");
pageTracker._trackPageview();
} catch(err) {}</script>
<script type="text/javascript">
    var disqus_shortname = 'leelir';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

    <!-- Le javascript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://leelir.github.io/theme/js/jquery-1.7.2.min.js"></script>
    <script src="https://leelir.github.io/theme/js/bootstrap.min.js"></script>
  </body>
</html>